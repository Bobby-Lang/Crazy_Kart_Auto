from PyQt6.QtWidgets import QStackedWidget, QFrame, QButtonGroup

# ... ä¹‹å‰çš„å¯¼å…¥ä¿æŒä¸å˜ ...

class MainWindow(QMainWindow):
    def __init__(self):
        super().__init__()
        self.cfg_mgr = ConfigManager()
        self.init_ui()
        self.apply_modern_style() # åº”ç”¨æ ·å¼
        self.load_data()
        self.init_stats_timer()

    def apply_modern_style(self):
        # è¿™é‡Œå¯ä»¥ç›´æ¥åŠ è½½ä¸Šé¢çš„ QSS å­—ç¬¦ä¸²
        self.setStyleSheet("""
            /* å°†ä¸Šé¢çš„ QSS ç²˜è´´åœ¨è¿™é‡Œ */
        """)

    def init_ui(self):
        self.setWindowTitle("Auto Game Pro")
        self.setGeometry(100, 100, 1280, 850)

        # ä¸»å®¹å™¨
        central_widget = QWidget()
        self.setCentralWidget(central_widget)
        main_layout = QHBoxLayout(central_widget)
        main_layout.setContentsMargins(0, 0, 0, 0)
        main_layout.setSpacing(0)

        # --- 1. ä¾§è¾¹å¯¼èˆªæ  ---
        self.sidebar = QFrame()
        self.sidebar.setObjectName("sidebar")
        sidebar_layout = QVBoxLayout(self.sidebar)
        sidebar_layout.setContentsMargins(0, 20, 0, 20)

        # æ ‡é¢˜/Logo
        logo_label = QLabel("AUTO GAME")
        logo_label.setStyleSheet("font-size: 20px; font-weight: bold; color: #bb9af7; margin-bottom: 20px; padding: 10px;")
        sidebar_layout.addWidget(logo_label)

        # å¯¼èˆªæŒ‰é’®ç»„
        self.nav_group = QButtonGroup(self)
        self.nav_group.setExclusive(True)

        self.btn_dashboard = self.create_nav_btn("ğŸš€ è¿è¡Œé¢æ¿", 0)
        self.btn_accounts = self.create_nav_btn("ğŸ‘¤ è´¦å·ç®¡ç†", 1)
        self.btn_settings = self.create_nav_btn("âš™ï¸ ç³»ç»Ÿè®¾ç½®", 2)
        
        sidebar_layout.addWidget(self.btn_dashboard)
        sidebar_layout.addWidget(self.btn_accounts)
        sidebar_layout.addWidget(self.btn_settings)
        sidebar_layout.addStretch()

        main_layout.addWidget(self.sidebar)

        # --- 2. å³ä¾§å†…å®¹åŒº ---
        content_container = QVBoxLayout()
        
        # é¡¶éƒ¨çŠ¶æ€æ¡
        self.top_bar = QFrame()
        self.top_bar.setFixedHeight(60)
        self.top_bar.setStyleSheet("background-color: #1a1b26; border-bottom: 1px solid #24283b;")
        top_layout = QHBoxLayout(self.top_bar)
        self.status_title = QLabel("è¿è¡ŒçŠ¶æ€: å°±ç»ª")
        top_layout.addWidget(self.status_title)
        top_layout.addStretch()
        content_container.addWidget(self.top_bar)

        # æ ¸å¿ƒå †æ ˆå¸ƒå±€ (ç”¨äºåˆ‡æ¢é¡µé¢)
        self.stack = QStackedWidget()
        self.stack.addWidget(self.create_control_tab()) # Index 0
        self.stack.addWidget(self.create_account_tab()) # Index 1
        self.stack.addWidget(self.create_config_tab())  # Index 2
        
        content_container.addWidget(self.stack)
        
        # å°†å†…å®¹åŒºåŠ å…¥ä¸»å¸ƒå±€
        main_layout.addLayout(content_container)

    def create_nav_btn(self, text, index):
        btn = QPushButton(text)
        btn.setObjectName("nav_btn")
        btn.setCheckable(True)
        if index == 0: btn.setChecked(True)
        btn.clicked.connect(lambda: self.stack.setCurrentIndex(index))
        return btn

    # ... æ”¹é€ åçš„ create_control_tab ...
    def create_control_tab(self):
        page = QWidget()
        layout = QVBoxLayout(page)
        
        # ä½¿ç”¨å¡ç‰‡å¼å®¹å™¨
        card = QFrame()
        card.setObjectName("card")
        card_layout = QVBoxLayout(card)
        
        # ç»Ÿè®¡é¢æ¿ (æ°´å¹³æ’å¸ƒï¼Œåƒ Dashboard ä»ªè¡¨ç›˜)
        stats_layout = QHBoxLayout()
        # è¿™ç§å¯ä»¥åšæˆå°å¡ç‰‡ç»„ä»¶
        # ... è¿™é‡Œæ·»åŠ è¿›åº¦æ¡å’Œç»Ÿè®¡ ...
        
        card_layout.addLayout(stats_layout)
        layout.addWidget(card)
        
        # æ“ä½œæŒ‰é’®
        btn_box = QHBoxLayout()
        self.launch_run_btn = QPushButton("ğŸš€ å…¨åŠ›å¯åŠ¨")
        self.launch_run_btn.setObjectName("primary_btn") # ä½¿ç”¨ QSS ä¸­çš„å¼ºè°ƒè‰²
        self.stop_btn = QPushButton("â¹ åœæ­¢è¿è¡Œ")
        self.stop_btn.setObjectName("stop_btn")         # ä½¿ç”¨çº¢è‰²
        
        btn_box.addWidget(self.launch_run_btn)
        btn_box.addWidget(self.stop_btn)
        layout.addLayout(btn_box)

        # æ—¥å¿—åŒºåŸŸå æ®ä¸‹æ–¹
        layout.addWidget(self.create_log_group())
        
        return page